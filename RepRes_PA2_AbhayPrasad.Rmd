
# Assessing the impact of natural calamities on US population health and the economy using the NOAA database

### Peer Assignment 2 for Coursera Reproducible Research

# Synopsis

The basic goal of this assignment is to explore the NOAA Storm Database and answer some basic questions about the effect of weather events in the US on the health and safety of it's people and the economy.

Using the NOAA database, this data analysis addresses the following two questions:

- Which types of events (as indicated by the variable EVTYPE) have the most severe and harmful effect on population health (as indicated by the variables INJURIES and FATALITIES). This assessment is done by combining both variables and treating the resultant variable as an indication of total effect on health.

- Which types of events (as indicated by the variable EVTYPE) have the most severe effect on the economy in terms of damage to property (as measured by the variable PROPDMG) or crop (as measured by the variable CROPDMG).  This assessment is done by combining both variables and treating the resultant variable as an indication of total effect on the economy.

These two questions are answered below in  two sepearate analysis using R Programming.

The overall analysis reveals that, across the United States, tornadoes (EVTYPE=TORNADO) have the most severe impact on population health and combined damage to property and crop.

##Data Processing

The code chunk below is to set or load packages that will be required. These packages have already been installed [using "intall.packages()"].

```{r}
options(rpubs.upload.method = "internal")
echo = TRUE  # To make the code chunks visible in the Knit HTML output
options(scipen = 1)  # To turn off scientific notations for numbers
library(R.utils) # Primarily needed to process the Bunzip2 raw data file
library(ggplot2) # Needed for plotting
library(stringr)
```

Data Download and Extraction

The data are downloaded from a mirror that hosts the NOAA data at the URL stated in the assignment page on the course web site. The downloaded file is in the form of a comma-separated-value file compressed via the bzip2 algorithm to reduce its size. The code below shows that the file is downloaded to the home working directory and the bzip2 file is unzipped or uncompressed as a comma delimited file using the R.utils bunzip2() function.

The file was downloaded using the following code (shown as text rather than as code chunk to avoid the time-consuming set of downloading the file running again):

fileUrl <- "http://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"

download.file(fileUrl, destfile="~/stormData.csv.bz2")

bunzip2("~/stormData.csv.bz2", overwrite=T, remove=F)


###Loading the data for processing

```{r}
storm <- read.csv("~/stormData.csv")
```

In addition to looking at the documentation of the database available at:

[National Weather Service Storm Data Documentation](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf) and
[National Climatic Data Center Storm Events FAQ](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2FNCDC%20Storm%20Events-FAQ%20Page.pdf), the following functions help get a general sense of the contents of the database.

These are the variable names in the database:
```{r}
names(storm)
head(storm)
```

These are the dimensions (number of rows and columns) of the database:
```{r}
dim(storm)
```

The analyses required for these two equestions do not require us to analyse all the variables (columns) in the database. The questions can be addressed by only analysing these seven variables: EVTYPE, FATALITIES, INJURIES, PROPDMG, CROPDMG, PROPDMGEXP, CROPDMGEXP. Hence, for further analysis and to enable faster processing, we extract and keep only the data pertaining to these five variables.

```{r Extracting Relevant Data from the Database}
keepdata <- c("EVTYPE", "FATALITIES", "INJURIES", "PROPDMG", "CROPDMG", "PROPDMGEXP", "CROPDMGEXP")
storm <- storm[keepdata]
dim(storm)
```

# Results

## Analysis 1: Which event type has the most severe effect in terms of Fatalities and Injuries? Answer: Tornadoes.

```{r Analyzing and plotting the effect of EVTYPE on FATALITIES and INJURIES}
storm$Health <- storm$FATALITIES + storm$INJURIES
health <- sort(tapply(storm$Health, storm$EVTYPE, sum), decreasing=TRUE)
fatal <- sort(tapply(storm$FATALITIES, storm$EVTYPE, sum), decreasing=TRUE)
injure <- sort(tapply(storm$INJURIES, storm$EVTYPE, sum), decreasing=TRUE)
health <- head(health, 15)
fatal <- head(fatal, 15)
injure <- head(injure, 15)
health <- as.data.frame(cbind(event=names(health), count=health, type="Overall Public Health"))
fatal <- as.data.frame(cbind(event=names(fatal), count=fatal, type="Fatalities"))
injure <- as.data.frame(cbind(event=names(injure), count=injure, type="Injuries"))
d <- rbind(health, fatal, injure)
d$count <- as.integer(as.character(d$count))
d <- transform(d, event = reorder(event, -count))
ggplot(d, aes(x=event, y=count, fill=type)) + geom_bar(stat="identity") + facet_wrap(~type, scales = "free") + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.6)) + ggtitle("Effect on Public Health by event type")
```

###Tornadoes are the leading cause of fatalities and injuries in the US.


## Analysis 2: Which event type has most severe effect on the economy in terms of damage to Property and Crop? Answer: Tornadoes, again.

```{r Analyzing and plotting the effect of EVTYPE on  PROPDMG and CROPDMG}
storm2 <- storm[c("EVTYPE", "PROPDMG", "CROPDMG", "PROPDMGEXP", "CROPDMGEXP")]
storm2$PROPDMG <- as.numeric(as.character(storm2$PROPDMG))
storm2$CROPDMG <- as.numeric(as.character(storm2$CROPDMG))
storm2$Prop_Hazards <- storm2$PROPDMG + storm2$CROPDMG
p <- sort(tapply(storm2$Prop_Hazards, storm2$EVTYPE, sum), decreasing=TRUE)
property <- sort(tapply(storm2$PROPDMG, storm2$EVTYPE, sum), decreasing=TRUE)
crop <- sort(tapply(storm2$CROPDMG, storm2$EVTYPE, sum), decreasing=TRUE)
property <- head(property, 15)
crop <- head(crop, 15)
p <- head(p, 15)
p <- as.data.frame(cbind(event=names(p), count=p, type="Combined Economic Damage"))
property <- as.data.frame(cbind(event=names(property), count=property, type="Damage to Property"))
crop <- as.data.frame(cbind(event=names(crop), count=crop, type="Damage to Crop"))
d <- rbind(p, property, crop)
d$count <- as.integer(as.character(d$count))
d <- transform(d, event = reorder(event, -count))
ggplot(d, aes(x=event, y=count, fill=type)) + geom_bar(stat="identity") + facet_wrap(~type, scales = "free") + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5)) + ggtitle("Economic Damage by event type")
```

###While Hail causes the most damage to crops (and is only the sixth leading cause of damage to property), tornadoes are the leading cause of damage to crop and property combined.



## This is the computing environment 
```{r}
sessionInfo()
```

##
Abhay Prasad
```{r}
date()
```
